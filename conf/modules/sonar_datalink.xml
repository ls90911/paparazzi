<!DOCTYPE module SYSTEM "module.dtd">
<module name="sonar_datalink" dir="sonar">
  <doc>
    <description>
     Sonar Datalink.
     Be able to handle sonar messages from an intermcu device
     Get the measured distance value and outputs converted (AGL) distance in [m]
    </description>
    <define name="SONAR_OFFSET" value="0" description="sensor offset in meters - default is 0"/>
    <configure name="USE_SONAR_DATALINK_AGL" value="0" description="Use this device to update AGL measurements"/>
    <configure name="SONAR_DATALINK_COMPENSATE_ROTATION" value="1" description="Compensate AGL measurements for body rotation"/>
    <configure name="SONAR_DATALINK_MEDIAN_LENGTH" value="7" description="Length of median filter for distance measurements"/>
    <define name="SENSOR_SYNC_SEND_SONAR" value="TRUE|FALSE" description="Flag to transmit the data as it is acquired"/>
  </doc>

  <settings>
    <dl_settings NAME="Sonar Datalink">
      <dl_settings NAME="Sonar">
        <dl_setting MAX="1" MIN="0" STEP="1" VAR="sonar_datalink.update_agl" shortname="update_agl"/>
        <dl_setting MAX="1" MIN="0" STEP="1" VAR="sonar_datalink.compensate_rotation" shortname="derotate AGL"/>
      </dl_settings>
    </dl_settings>
  </settings>

  <header>
    <file name="sonar_datalink.h"/>
  </header>
  <init fun="sonar_datalink_init()"/>
  <periodic fun="sonar_datalink_downlink()" freq="4" autorun="FALSE"/> <!-- for debug -->
  <periodic fun="sonar_datalink_periodic()" freq="10"/>
  <makefile target="ap">
    <define name="USE_SONAR_DATALINK_AGL" value="$(USE_SONAR_DATALINK_AGL)"/>
    <define name="SONAR_DATALINK_COMPENSATE_ROTATION" value="$(SONAR_DATALINK_COMPENSATE_ROTATION)"/>
    <define name="SONAR_DATALINK_MEDIAN_LENGTH" value="$(SONAR_DATALINK_MEDIAN_LENGTH)"/>
    <file name="sonar_datalink.c"/>
  </makefile>
  <makefile target="sim|nps">
    <define name="USE_SONAR_DATALINK_AGL" value="$(USE_SONAR_DATALINK_AGL)"/>
    <define name="SONAR_DATALINK_COMPENSATE_ROTATION" value="$(SONAR_DATALINK_COMPENSATE_ROTATION)"/>
    <define name="SONAR_DATALINK_MEDIAN_LENGTH" value="$(SONAR_DATALINK_MEDIAN_LENGTH)"/>
    <define name="USE_SONAR"/>
  </makefile>
</module>